<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/sidebar-styles.css">
    
    <script src="js/config.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/settings-manager.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/event-bus.js"></script>
    <script src="js/data-cache.js"></script>
    <script src="js/ftue.js"></script>
    
    <script src="js/module-manager.js"></script>
    <script src="js/components/expenses/categories.js"></script>
    <script src="js/components/expenses/merchant-mappings.js"></script>
    <script src="js/components/expenses/expense-crud.js"></script>
    <script src="js/modules/task-crud.js"></script>
    <script src="js/modules/goal-crud.js"></script>
    <script src="js/modules/note-crud.js"></script>
    <script src="js/cached-crud.js"></script>

    <script src="js/components/expenses/expense-widget.js"></script>
    <script src="js/components/expenses/expense-stats.js"></script>
    <script src="js/components/expenses/expense-filters.js"></script>
    <script src="js/components/expenses/expense-import.js"></script>
    <script src="js/components/expenses/expense-renderer.js"></script>
    <script src="js/components/expenses/modals/import-modal.js"></script>
    <script src="js/components/expenses/modals/category-modal.js"></script>
    <script src="js/components/expenses/modals/form-modal.js"></script>
    <script src="js/components/expenses/expense-modals.js"></script>
    <script src="js/components/expenses/expenses-main.js"></script>

    <script src="js/components/statistics.js"></script>
    <script src="js/components/core_widgets.js"></script>
    <script src="js/components/dashboard.js"></script>
    <script src="js/components/agenda/agenda_view.js"></script>
    <script src="js/components/agenda/agenda_google_importer.js"></script>
    <script src="js/components/agenda/agenda_widgets.js"></script>
    <script src="js/components/agenda/agenda.js"></script>
    <script src="js/components/goals.js"></script>
    <script src="js/components/settings.js"></script>
    <script src="js/components/modules.js"></script>
    <script src="js/components/diet.js"></script>
    
    <script src="js/navigation.js"></script>
    <script src="js/app-init.js"></script>
</head>

<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-200">
    <div id="global-loader" class="fixed inset-0 z-[9999] bg-[#0B1120] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="relative mb-6">
            <div class="w-16 h-16 border-4 border-slate-800 border-t-indigo-500 rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <svg class="w-6 h-6 text-indigo-500/50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
            </div>
        </div>
        <div class="text-center">
            <p id="loader-status" class="text-indigo-400 font-medium tracking-wide mb-1">Inizializzazione...</p>
            <p id="loader-substatus" class="text-slate-500 text-sm italic">Preparazione ambiente</p>
        </div>
    </div>
    <div id="modalsContainer"></div>
    
    <div class="flex h-screen overflow-hidden">
        
        <aside id="sidebar" class="w-72 bg-[#0B1120] border-r border-slate-800/60 flex flex-col relative z-50 shadow-2xl transition-all duration-300">
            
            <div class="h-24 flex items-center px-6 border-b border-slate-800/40">
                <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-500/20 mr-3">
                    <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-white tracking-tight">MyFinance</h1>
                    <p class="text-[10px] text-slate-500 font-medium tracking-widest uppercase">Personal Suite</p>
                </div>
            </div>

            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto scrollbar-hide">
                
            </nav>

        </aside>

        <main class="flex-1 overflow-y-auto">
            <div class="p-8">
                <div id="dashboardContent" class="content-section">
                    <div class="flex items-center justify-center py-20">
                        <div class="text-center">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mb-4"></div>
                            <p class="text-slate-400">Inizializzazione Dashboard...</p>
                        </div>
                    </div>
                </div>

                <div id="expensesContent" class="content-section hidden"></div>
                <div id="statisticsContent" class="content-section hidden"></div>
                <div id="agendaContent" class="content-section hidden"></div>
                <div id="goalsContent" class="content-section hidden"></div>
                <div id="settingsContent" class="content-section hidden"></div>
                <div id="modulesContent" class="content-section hidden"></div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
        if (!window.supabaseClient) return;

        const { data: { user }, error } = await window.supabaseClient.auth.getUser();
        
        if (error || !user) {
            window.location.href = 'login.html';
            return;
        }
        
        // Gestione UI Utente
        const displayName = user.user_metadata?.name || user.email.split('@')[0];
        const userEl = document.getElementById('userName');
        const avatarEl = document.getElementById('userAvatar');
        if(userEl) userEl.textContent = displayName;
        if(avatarEl) avatarEl.textContent = displayName.charAt(0).toUpperCase();

        const logoutBtn = document.getElementById('logoutBtn');
        if(logoutBtn) {
            logoutBtn.addEventListener('click', async () => {
                if (confirm('Vuoi davvero uscire?')) {
                    await window.supabaseClient.auth.signOut();
                    window.location.href = 'login.html';
                }
            });
        }
    });
    </script>
</body>
</html>
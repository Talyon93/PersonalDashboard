<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login - MyFinance Premium</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script src="js/config.js"></script>
  <script src="js/supabase-config.js"></script>

  <style>
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fadeIn { animation: fadeIn 0.6s ease-out forwards; }
  </style>
</head>

<body class="min-h-screen bg-[#0f172a] flex items-center justify-center p-6 font-sans selection:bg-indigo-500/30">
  
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute -top-[10%] -left-[10%] w-[40%] h-[40%] bg-indigo-600/20 rounded-full blur-[120px]"></div>
    <div class="absolute -bottom-[10%] -right-[10%] w-[40%] h-[40%] bg-purple-600/20 rounded-full blur-[120px]"></div>
  </div>

  <div class="w-full max-w-md relative z-10 animate-fadeIn">
    <div class="bg-slate-800/30 backdrop-blur-2xl rounded-[2.5rem] border border-slate-700/50 shadow-2xl p-10">
      
      <div class="flex flex-col items-center text-center mb-10">
        <div class="h-20 w-20 rounded-3xl bg-gradient-to-br from-indigo-500 via-purple-600 to-pink-500 flex items-center justify-center shadow-2xl shadow-indigo-500/20 mb-6 transform hover:rotate-3 transition-transform">
          <span class="text-4xl">ðŸ’°</span>
        </div>
        <h1 class="text-4xl font-black tracking-tighter bg-gradient-to-r from-white via-slate-200 to-slate-400 bg-clip-text text-transparent italic">
          MyFinance
        </h1>
        <p class="mt-2 text-slate-400 font-medium text-sm tracking-tight">Gestione centralizzata attivitÃ  e finanze.</p>
      </div>

      <div id="alertBox" class="hidden mb-6 rounded-2xl border px-5 py-3 text-sm font-bold text-center transition-all"></div>

      <div class="bg-slate-900/50 p-1.5 rounded-2xl border border-slate-700/50 grid grid-cols-2 gap-2 mb-8 shadow-inner">
        <button id="tabLogin" class="py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all">
          Accedi
        </button>
        <button id="tabRegister" class="py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all">
          Crea Account
        </button>
      </div>

      <form id="authForm" class="space-y-5">
        <div class="space-y-1.5">
          <label class="block text-[10px] font-black uppercase tracking-widest text-slate-500 ml-4" for="email">Email</label>
          <input id="email" type="email" autocomplete="email" required
                 class="w-full bg-slate-900/50 border-2 border-slate-700/50 rounded-2xl px-5 py-4 text-white placeholder-slate-600 focus:border-indigo-500/50 focus:outline-none transition-all font-medium"
                 placeholder="nome@esempio.com"/>
        </div>

        <div class="space-y-1.5">
          <label class="block text-[10px] font-black uppercase tracking-widest text-slate-500 ml-4" for="password">Password</label>
          <input id="password" type="password" autocomplete="current-password" required
                 class="w-full bg-slate-900/50 border-2 border-slate-700/50 rounded-2xl px-5 py-4 text-white placeholder-slate-600 focus:border-indigo-500/50 focus:outline-none transition-all font-medium"
                 placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
        </div>

        <div id="confirmWrap" class="hidden space-y-1.5">
          <label class="block text-[10px] font-black uppercase tracking-widest text-slate-500 ml-4" for="passwordConfirm">Conferma Password</label>
          <input id="passwordConfirm" type="password" autocomplete="new-password"
                 class="w-full bg-slate-900/50 border-2 border-slate-700/50 rounded-2xl px-5 py-4 text-white placeholder-slate-600 focus:border-indigo-500/50 focus:outline-none transition-all font-medium"
                 placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
        </div>

        <button id="submitBtn" type="submit"
                class="w-full py-4 mt-4 rounded-2xl font-black uppercase text-xs tracking-[0.2em] text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:scale-[1.02] active:scale-95 transition-all shadow-xl shadow-indigo-500/20">
          Accedi
        </button>

        <div class="pt-6 text-center">
            <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center justify-center gap-2">
                <span class="w-1 h-1 bg-emerald-500 rounded-full animate-pulse"></span>
                Connessione Sicura Criptata
            </p>
        </div>
      </form>
    </div>
  </div>

  <script>
    if (!window.supabaseClient) {
      console.error("âŒ window.supabaseClient non trovato.");
    }

    const alertBox = document.getElementById("alertBox");
    const tabLogin = document.getElementById("tabLogin");
    const tabRegister = document.getElementById("tabRegister");
    const confirmWrap = document.getElementById("confirmWrap");
    const submitBtn = document.getElementById("submitBtn");
    const authForm = document.getElementById("authForm");

    let mode = "login";

    function setAlert(type, message) {
      alertBox.classList.remove("hidden");
      if (type === "error") {
        alertBox.className = "mb-6 rounded-2xl border-2 border-rose-500/20 bg-rose-500/10 text-rose-400 px-5 py-3 text-sm font-bold text-center";
      } else {
        alertBox.className = "mb-6 rounded-2xl border-2 border-emerald-500/20 bg-emerald-500/10 text-emerald-400 px-5 py-3 text-sm font-bold text-center";
      }
      alertBox.textContent = message;
    }

    function clearAlert() {
      alertBox.classList.add("hidden");
    }

    function setMode(nextMode) {
      mode = nextMode;
      clearAlert();

      const activeClass = "bg-indigo-600 text-white shadow-lg";
      const inactiveClass = "text-slate-400 hover:text-white";

      if (mode === "login") {
        tabLogin.className = `py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all ${activeClass}`;
        tabRegister.className = `py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all ${inactiveClass}`;
        confirmWrap.classList.add("hidden");
        submitBtn.textContent = "Accedi";
      } else {
        tabRegister.className = `py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all ${activeClass}`;
        tabLogin.className = `py-2.5 rounded-xl text-xs font-black uppercase tracking-widest transition-all ${inactiveClass}`;
        confirmWrap.classList.remove("hidden");
        submitBtn.textContent = "Crea Account";
      }
    }

    tabLogin.addEventListener("click", () => setMode("login"));
    tabRegister.addEventListener("click", () => setMode("register"));

    authForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      clearAlert();

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const passwordConfirm = document.getElementById("passwordConfirm").value;

      submitBtn.disabled = true;
      const oldText = submitBtn.textContent;
      submitBtn.textContent = "Sincronizzazione...";

      try {
        if (mode === "register") {
          if (passwordConfirm !== password) {
            setAlert("error", "Le password non corrispondono.");
            return;
          }
          const { error } = await window.supabaseClient.auth.signUp({ email, password });
          if (error) throw error;
          setAlert("ok", "Account creato! Controlla l'email.");
          setMode("login");
        } else {
          const { error } = await window.supabaseClient.auth.signInWithPassword({ email, password });
          if (error) throw error;
          window.location.href = "index.html";
        }
      } catch (err) {
        setAlert("error", err.message);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = oldText;
      }
    });

    setMode("login");
  </script>
</body>
</html>